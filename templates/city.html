{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- City Header -->
    <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
            Hospitals in {{ city_name }}
        </h1>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
            Find and book hospital beds in {{ city_name }}. Compare top-rated medical facilities, 
            check real-time bed availability, and secure your booking instantly.
        </p>
    </div>
    
    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
        <div class="bg-white rounded-lg shadow-md p-6 text-center">
            <div class="text-3xl font-bold text-medical-blue mb-2">{{ hospitals|length }}</div>
            <div class="text-gray-600">Hospitals Available</div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 text-center">
            <div class="text-3xl font-bold text-medical-green mb-2">
                {% set total_beds = hospitals|sum(attribute='total_beds') %}
                {{ total_beds() if total_beds else 0 }}
            </div>
            <div class="text-gray-600">Total Beds</div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 text-center">
            <div class="text-3xl font-bold text-yellow-600 mb-2">
                {% if hospitals %}
                    {{ "%.1f"|format(hospitals|sum(attribute='doctor_rating')/hospitals|length) }}
                {% else %}
                    0.0
                {% endif %}
            </div>
            <div class="text-gray-600">Average Rating</div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 text-center">
            <div class="text-3xl font-bold text-purple-600 mb-2">24/7</div>
            <div class="text-gray-600">Emergency Care</div>
        </div>
    </div>
    
    <!-- Search Filter -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-bold text-gray-900 mb-4">Filter {{ city_name }} Hospitals</h3>
        
        <form action="{{ url_for('search') }}" method="GET" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <input type="hidden" name="city" value="{{ city_name }}">
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Medical Specialty</label>
                <select name="specialty" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medical-blue">
                    <option value="">Any Specialty</option>
                    <option value="Cardiology">Cardiology</option>
                    <option value="Neurology">Neurology</option>
                    <option value="Orthopedics">Orthopedics</option>
                    <option value="Emergency Medicine">Emergency Medicine</option>
                    <option value="Pediatrics">Pediatrics</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Bed Type</label>
                <select name="bed_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medical-blue">
                    <option value="">Any Type</option>
                    <option value="ICU">ICU</option>
                    <option value="General">General</option>
                    <option value="Private">Private</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Maximum Fee ($)</label>
                <input type="number" name="max_fee" placeholder="Enter max fee" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medical-blue">
            </div>
            
            <div class="flex items-end">
                <button type="submit" class="w-full bg-medical-blue text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                    <i class="fas fa-search mr-2"></i>Apply Filters
                </button>
            </div>
        </form>
    </div>
    
    <!-- Hospitals List -->
    {% if hospitals %}
        <div class="space-y-6">
            {% for hospital in hospitals %}
            <div class="hospital-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                <div class="md:flex">
                    <div class="md:w-1/3">
                        <img src="{{ hospital.image_url or 'https://images.unsplash.com/photo-1586773860418-d37222d8fce3?w=400&h=250&fit=crop' }}" 
                             alt="{{ hospital.name }}" class="w-full h-48 md:h-full object-cover">
                    </div>
                    
                    <div class="md:w-2/3 p-6">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-bold text-gray-900">{{ hospital.name }}</h3>
                            <div class="flex items-center">
                                {% for i in range(5) %}
                                    <i class="fas fa-star {% if i < hospital.doctor_rating %}rating-stars{% else %}text-gray-300{% endif %} text-sm"></i>
                                {% endfor %}
                                <span class="text-sm text-gray-600 ml-1">{{ hospital.doctor_rating }}</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center text-gray-600 mb-3">
                            <i class="fas fa-map-marker-alt mr-2 text-medical-blue"></i>
                            <span>{{ hospital.address }}</span>
                        </div>
                        
                        <p class="text-gray-600 mb-4">{{ hospital.description[:150] }}...</p>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 text-sm">
                            <div>
                                <span class="text-gray-500">Available Beds:</span>
                                <div class="font-medium">{{ hospital.total_beds() }}</div>
                            </div>
                            <div>
                                <span class="text-gray-500">Success Rate:</span>
                                <div class="font-medium text-medical-green">{{ hospital.success_rate }}%</div>
                            </div>
                            <div>
                                <span class="text-gray-500">Consultation Fee:</span>
                                <div class="font-medium text-medical-blue">${{ hospital.consultation_fee }}</div>
                            </div>
                            <div>
                                <span class="text-gray-500">Phone:</span>
                                <div class="font-medium">
                                    <a href="tel:{{ hospital.phone }}" class="hover:text-medical-blue">{{ hospital.phone }}</a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-2 mb-4">
                            {% for specialty in hospital.get_specialties()[:3] %}
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">{{ specialty }}</span>
                            {% endfor %}
                            {% if hospital.get_specialties()|length > 3 %}
                                <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">+{{ hospital.get_specialties()|length - 3 }} more</span>
                            {% endif %}
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div class="flex items-center space-x-4">
                                {% for bed_type, count in hospital.get_available_beds().items() %}
                                    <div class="text-xs">
                                        <span class="text-gray-500">{{ bed_type }}:</span>
                                        <span class="font-medium {% if count > 0 %}text-medical-green{% else %}text-red-500{% endif %}">
                                            {{ count }}
                                        </span>
                                    </div>
                                {% endfor %}
                            </div>
                            
                            <div class="space-x-2">
                                <a href="{{ url_for('hospital_detail', id=hospital.id) }}" 
                                   class="inline-block px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors text-sm">
                                    View Details
                                </a>
                                <a href="{{ url_for('book_hospital', id=hospital.id) }}" 
                                   class="inline-block px-4 py-2 bg-medical-blue text-white rounded-md hover:bg-blue-700 transition-colors text-sm">
                                    Book Now
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <!-- No Hospitals State -->
        <div class="text-center py-12">
            <i class="fas fa-hospital text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-medium text-gray-900 mb-2">No hospitals found in {{ city_name }}</h3>
            <p class="text-gray-600 mb-6">We're working to add more hospitals in this area. Try searching nearby cities or browse all available hospitals.</p>
            <div class="space-x-4">
                <a href="{{ url_for('search') }}" 
                   class="inline-block bg-medical-blue text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                    Search All Hospitals
                </a>
                <a href="{{ url_for('contact') }}" 
                   class="inline-block bg-gray-100 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-200 transition-colors">
                    Contact Us
                </a>
            </div>
        </div>
    {% endif %}
    
    <!-- City Information -->
    <div class="mt-12 bg-gradient-to-r from-medical-blue to-blue-600 rounded-lg p-8 text-white">
        <div class="text-center">
            <h3 class="text-2xl font-bold mb-4">Healthcare in {{ city_name }}</h3>
            <p class="text-blue-100 mb-6 max-w-3xl mx-auto">
                {{ city_name }} offers world-class healthcare facilities with state-of-the-art equipment and experienced medical professionals. 
                Our platform connects you with the best hospitals in the area for your specific medical needs.
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                <div class="text-center">
                    <i class="fas fa-ambulance text-3xl mb-3"></i>
                    <h4 class="font-bold mb-2">Emergency Services</h4>
                    <p class="text-blue-100 text-sm">24/7 emergency care available at multiple locations</p>
                </div>
                
                <div class="text-center">
                    <i class="fas fa-user-md text-3xl mb-3"></i>
                    <h4 class="font-bold mb-2">Specialist Care</h4>
                    <p class="text-blue-100 text-sm">Access to specialized medical professionals and treatments</p>
                </div>
                
                <div class="text-center">
                    <i class="fas fa-heart text-3xl mb-3"></i>
                    <h4 class="font-bold mb-2">Quality Care</h4>
                    <p class="text-blue-100 text-sm">High success rates and patient satisfaction scores</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}